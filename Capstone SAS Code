* Importing csv file into SAS Library *;
FILENAME MEPS '/home/u45270852/sasuser.v94/h209.ssp';

PROC CIMPORT data = CAPSTONE.MEPS infile = MEPS;
RUN;

* Details of full year MEPS dataset *;
PROC DATASETS;
CONTENTS DATA=CAPSTONE.MEPS;
RUN;


* Creating condensed dataset from full MEPS dataset *;
PROC SQL;
CREATE TABLE CAPSTONE.NEW_MEPS AS
SELECT RTHLTH31 , RTHLTH42 , RTHLTH53 , MNHLTH31 , MNHLTH42 , MNHLTH53 , HIBPDX , HIBPAGED , BPMLDX , 
CHDDX , CHDAGED , ANGIDX , ANGIAGED , MIDX , MIAGED , OHRTDX , OHRTAGED , OHRTTYPE , STRKDX , STRKAGED , 
EMPHDX , EMPHAGED , CHBRON31 , CHOLDX , CHOLAGED , CANCERDX , CABLADDR , CABREAST , CACERVIX , CACOLON , 
CALUNG , CALYMPH , CAMELANO , CAOTHER , CAPROSTA , CASKINNM , CASKINDK , CAUTERUS , DIABDX_M18 , DIABAGED , 
JTPAIN31_M18 , ARTHDX , ARTHTYPE , ARTHAGED , ASTHDX , ASTHAGED , ASSTIL31 , ASATAK31 , ASTHEP31 , ASACUT31 , 
ASMRCN31 , ASPREV31 , ASDALY31 , ASPKFL31 , ASEVFL31 , ASWNFL31 , ADHDADDX , ADHDAGED , TOTTCH18 , TOTEXP18 , 
TOTSLF18 , OBTOTV18 , OBDRV18 , OPTOTV18 , OPDRV18 , ERTOT18 , IPDIS18 , IPNGTD18 , DVTOT18 ,
HHTOTD18 , HHAGD18 , HHINDD18 , HHINFD18 , RXTOT18 , REGION18 FROM CAPSTONE.MEPS;
RUN;
QUIT;

* Details of condensed MEPS dataset *;
PROC DATASETS NOLIST NODETAILS;
CONTENTS DATA=CAPSTONE.NEW_MEPS OUT=CAPSTONE.MEPS_details;
RUN;

PROC PRINT DATA=CAPSTONE.MEPS_details;
RUN;

* PROC CONTENTS provides information on the new SAS dataset *;
PROC CONTENTS DATA=CAPSTONE.NEW_MEPS; 
RUN;

* PROC MEANS provides simple statistics on utilization variables *;
PROC MEANS DATA=CAPSTONE.NEW_MEPS maxdec=2;
	VAR ERTOT18 IPDIS18 IPNGTD18
	DVTOT18 HHTOTD18 HHAGD18 HHINDD18 HHINFD18 RXTOT18;
RUN;

* PROC MEANS provides simple statistics on expenditure variables *;
PROC MEANS DATA=CAPSTONE.MEPS maxdec=2;
	VAR TOTEXP18 TOTSLF18 TOTTCH18 TOTMCD18 TOTMCR18 TOTOFD18 TOTOPU18 TOTSTL18 TOTPRV18;
RUN;

* PROC FREQ provides frequency statistics on diagnosed priority conditions*;
PROC FREQ DATA=CAPSTONE.NEW_MEPS;
	TABLE CHOLDX HIBPDX BPMLDX CHDDX ANGIDX MIDX CANCERDX DIABDX_M18;
RUN;

*create table for hypothesis 1*;
PROC SQL;
CREATE TABLE CAPSTONE.HYPO1 AS
SELECT HIBPDX, DIABDX_M18
FROM CAPSTONE.NEW_MEPS
WHERE HIBPDX IN (1,2)
AND DIABDX_M18 IN (1,2);
RUN;

* CORRELATION TEST - HYPOTHESIS 1 HIGH BLOOD PRESS AND DIABETES*; 
PROC CORR DATA=CAPSTONE.HYPO1 PLOTS=SCATTER PLOTS(MAXPOINTS=3000000);
	VAR HIBPDX DIABDX_M18;
RUN;

*create table for hypothesis 2*;
PROC SQL;
CREATE TABLE CAPSTONE.HYPO2 AS
SELECT CHOLDX, MIDX
FROM CAPSTONE.NEW_MEPS
WHERE CHOLDX IN (1,2)
AND MIDX IN (1,2);
RUN;

* CORRELATION TEST - HYPOTHESIS 2 HIGH CHOL AND HEART ATTACK*; 
PROC CORR DATA=CAPSTONE.HYPO2 PLOTS=SCATTER PLOTS(MAXPOINTS=3000000);
	VAR CHOLDX MIDX;
RUN;


* Creating dataset for hypothesis 3 *;
PROC SQL;
CREATE TABLE CAPSTONE.HYPOTHESIS_3 AS
SELECT HIBPDX , BPMLDX , CHDDX , ANGIDX , MIDX , 
CANCERDX , DIABDX_M18, ERTOT18 FROM CAPSTONE.NEW_MEPS
WHERE HIBPDX = 1 
OR BPMLDX= 1 
OR CHDDX = 1
OR ANGIDX = 1
OR MIDX = 1
OR CANCERDX = 1
OR DIABDX_M18 = 1;
RUN;
QUIT;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET HIBPDX = 11
WHERE HIBPDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET BPMLDX = 22
WHERE BPMLDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET CHDDX = 33
WHERE CHDDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET ANGIDX = 44
WHERE ANGIDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET MIDX = 55
WHERE MIDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET CANCERDX = 66
WHERE CANCERDX = 1;
RUN;

PROC SQL;
UPDATE CAPSTONE.HYPOTHESIS_3
SET DIABDX_M18 = 77
WHERE DIABDX_M18 = 1;
RUN;

PROC SQL;
SELECT *
FROM CAPSTONE.HYPOTHESIS_3;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.HIBP AS
SELECT HIBPDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE HIBPDX = 11;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.BPML AS
SELECT BPMLDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE BPMLDX = 22;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.CHD AS
SELECT CHDDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE CHDDX = 33;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.ANGI AS
SELECT ANGIDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE ANGIDX = 44;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.MI AS
SELECT MIDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE MIDX = 55;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.CANCER AS
SELECT CANCERDX, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE CANCERDX = 66;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.DIAB AS
SELECT DIABDX_M18, ERTOT18
FROM CAPSTONE.HYPOTHESIS_3
WHERE DIABDX_M18 = 77;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.HYPO3 AS
SELECT *
FROM CAPSTONE.HIBP
UNION ALL
SELECT *
FROM CAPSTONE.BPML
UNION ALL
SELECT *
FROM CAPSTONE.CHD
UNION ALL
SELECT *
FROM CAPSTONE.ANGI
UNION ALL
SELECT *
FROM CAPSTONE.MI
UNION ALL
SELECT *
FROM CAPSTONE.CANCER
UNION ALL
SELECT *
FROM CAPSTONE.DIAB;
RUN;

PROC SQL;
SELECT *
FROM CAPSTONE.HYPO3;
RUN;

PROC SQL;
CREATE TABLE CAPSTONE.HYPO3_NEW AS
SELECT HIBPDX AS CONDITION, ERTOT18
FROM CAPSTONE.HYPO3;
RUN;

* ANOVA TEST - HYPOTHESIS 3 ER UTILIZATION*;
PROC ANOVA DATA=CAPSTONE.HYPO3_NEW;
	CLASS CONDITION;
	MODEL ERTOT18 = CONDITION;
	MEANS CONDITION/TUKEY cldiff;
RUN;

* CREATING TABLE FOR HYPOTHESIS 4*;
PROC SQL;
CREATE TABLE CAPSTONE.DIAB_REGION AS
SELECT DIABDX_M18, REGION18
FROM CAPSTONE.NEW_MEPS
WHERE DIABDX_M18 = 1;
RUN;

PROC PRINT DATA = CAPSTONE.DIAB_REGION;
RUN;
